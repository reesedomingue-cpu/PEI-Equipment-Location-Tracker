<div style="max-width:400px; margin:auto; font-family:Segoe UI, sans-serif;">
  <h2>Equipment Location Update</h2>
  <form id="locationForm">
    <label for="unitNumber">Unit Number:</label><br>
    <input type="text" id="unitNumber" name="unitNumber" readonly style="width:100%; padding:8px; margin-top:4px;"><br><br>
    <button type="submit" style="padding:10px 20px; font-size:16px;">Submit</button>
  </form>
</div>

<script>
  // Prefill Unit Number from URL query string
  const params = new URLSearchParams(window.location.search);
  const unitInput = document.getElementById('unitNumber');
  if(params.has('unit')) {
    unitInput.value = params.get('unit');
  }

  const form = document.getElementById('locationForm');

  // Get GPS coordinates
  async function getLocation() {
    return new Promise((resolve, reject) => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => resolve(position.coords),
          (err) => reject(err)
        );
      } else {
        reject("Geolocation not supported by this browser.");
      }
    });
  }

  // Form submit
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    try {
      const coords = await getLocation();
      const data = {
        unitNumber: unitInput.value,
        latitude: coords.latitude,
        longitude: coords.longitude
      };

      const response = await fetch("https://defaultf4ae40429a0a4e568a37357921900e.7e.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/247fa41316c04ec49b1a3baa48ee5ec9/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=xpTLQQj1dnUYTJSeZY4blWWErtoEv5YEjwPUYTWj8XY", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      if(response.ok) {
        alert("Location submitted successfully!");
      } else {
        alert("Error submitting location. Please try again.");
      }

    } catch(err) {
      alert("Could not get location: " + err);
    }
  });
